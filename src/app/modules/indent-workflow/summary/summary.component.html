<div class="container-fluid  scroll-container">
    <div class="row g-2 align-items-start">

        <!-- LEFT : FINALIZED INDENT (FIXED HEIGHT) -->
        <div class="col-md-4 scroll-containe">
            <div class="card border-0 shadow-sm rounded-4">
                <div class="card-body p-2">

                    <!-- Header Actions -->
                    <div class="d-flex justify-content-between align-items-center mb-3">

                        <!-- LEFT: Back button -->
                        <div>
                            <i class="bi bi-chevron-left fs-4 cursor-pointer" (click)="back()"></i>
                        </div>

                        <!-- RIGHT: View Files button -->
                        <div>
                            <button *ngIf="indentDetailsData?.files" class="btn btn-sm custom-btn px-3"
                                (click)="openFiles()">
                                View Files
                            </button>

                            <!-- PDF Viewer Component -->
                            <app-view-file #pdfViewer [indentId]="Id"></app-view-file>
                        </div>

                    </div>


                    <!-- Title + Status -->
                    <div class="d-flex justify-content-between align-items-center border-bottom pb-2 mb-3">
                        <h6 class="fw-bold mb-0">Indent Summary</h6>

                        <!-- Status Image -->
                        <div class="d-flex align-items-center">
                            <!-- Approved -->
                            <img *ngIf="indentDetailsData?.status === 'Approved'"
                                src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRTSUTAjr-pQv-yRCJtNBfONIpiMUdIVOvsdw&s"
                                class="status-img" alt="Approved" />

                            <!-- Rejected -->
                            <img *ngIf="indentDetailsData?.status === 'Rejected'"
                                src="https://thumbs.dreamstime.com/b/reject-round-pink-gold-label-isolated-transparent-background-reject-reject-reject-round-pink-gold-label-isolated-343068466.jpg"
                                class="status-img" alt="Rejected" />

                            <!-- Pending / Others -->
                            <img *ngIf="indentDetailsData?.status !== 'Approved' && indentDetailsData?.status !== 'Rejected'"
                                src="https://thumbs.dreamstime.com/b/pending-pending-gold-badge-blue-ribbon-pending-120418122.jpg"
                                class="status-img pending" alt="Pending" />
                        </div>
                    </div>


                    <!-- Divider -->
                    <!-- <hr class="my-2" /> -->

                    <!-- INDENT SUMMARY -->
                    <div class="border rounded-3 p-3 mb-3 bg-light small">

                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-muted">Indent ID</span>
                            <span class="fw-semibold text-dark">
                                {{ indentDetailsData?.indentId }}
                            </span>
                        </div>

                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-muted">Planned Budget</span>
                            <span class="fw-bold text-success fs-6">
                                {{ indentDetailsData?.plannedBudget }}
                            </span>
                        </div>

                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-muted">Estimated Budget</span>
                            <span class="fw-bold text-success fs-6">
                                {{ indentDetailsData?.estimatedBudget }}
                            </span>
                        </div>

                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-muted">Approved Indent Value</span>
                            <span class="fw-bold text-success fs-6">
                                ₹ {{ getIndentGrandTotal() | number:'1.2-2' }}
                            </span>
                        </div>

                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-muted">Initiated Date</span>
                            <span class="fw-semibold text-dark">
                                {{ indentDetailsData?.initiatedDate | date: 'd MMM yyyy' }}

                            </span>
                        </div>

                        <!-- Initiator -->
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-muted">Initiated By</span>
                            <span class="fw-semibold text-dark">
                                {{ indentDetailsData?.history?.initiator?.initiatedBy | titlecase }}
                            </span>
                        </div>


                        <!-- Approver -->
                        <div *ngIf=" indentDetailsData?.history?.hod?.processedAt"
                            class="d-flex justify-content-between mb-2">
                            <span class="text-muted">Final Approved By</span>
                            <span class="fw-semibold text-dark">{{ indentDetailsData?.history?.hod?.processedBy |
                                titlecase }}</span>
                        </div>

                    </div>

                    <!-- MATERIAL DETAILS -->
                    <div class="border rounded-3 p-3 my-3 small"
                        *ngFor="let mat of indentDetailsData?.materials; let i = index">

                        <div class="fw-semibold mb-2">
                            Material {{ i + 1 }}
                        </div>

                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-muted">Material Name</span>
                            <span class="fw-semibold text-dark">
                                {{ mat.materialName }}
                            </span>
                        </div>

                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-muted">Quantity</span>
                            <span class="fw-semibold text-dark">
                                {{ mat.quantity }} {{ mat.unit }}
                            </span>
                        </div>

                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-muted">Unit Price</span>
                            <span class="fw-semibold text-dark">
                                ₹ {{ mat.unitPrice | number:'1.2-2' }}
                            </span>
                        </div>

                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-muted">Total Price</span>
                            <span class="fw-bold text-success fs-6">
                                ₹ {{ getMaterialTotal(mat) | number:'1.2-2' }}
                            </span>
                        </div>

                    </div>




                    <!-- Status Button -->
                    <button class="btn w-100 btn-sm fw-semibold" [ngClass]="{
                      'btn-success': indentDetailsData?.status === 'Approved',
                      'btn-danger': indentDetailsData?.status === 'Rejected',
                      'btn-warning': indentDetailsData?.status !== 'Approved' &&
                                     indentDetailsData?.status !== 'Rejected'
                    }">
                        <ng-container [ngSwitch]="indentDetailsData?.status">
                            <span *ngSwitchCase="'Approved'">✔ Approved</span>
                            <span *ngSwitchCase="'Rejected'">✖ Rejected</span>
                            <span *ngSwitchDefault>⏳ Pending</span>
                        </ng-container>
                    </button>



                </div>
            </div>
        </div>



        <!-- RIGHT : STAGE-WISE APPROVAL FLOW (EXPANDABLE) -->
        <div class="col-md-8 scroll-containe ">
            <div class="card border-0 shadow-sm">
                <div class="card-body">

                    <h6 class="fw-bold mb-3">Approval Stages</h6>

                    <!-- INITIAL STAGE  : Initiator -->
                    <div class="border rounded p-2 mb-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <p class="mb-0 fw-semibold">Indent Initiator</p>
                                <small class="text-muted">Quantity and Vendor</small>
                            </div>

                            <button class="btn btn-sm btn-outline-primary" data-bs-toggle="collapse"
                                data-bs-target="#initiatorStage">
                                +
                            </button>
                        </div>

                        <div id="initiatorStage" class="collapse mt-2 border-top pt-2">
                            <small class="text-muted">Activity Details</small>
                            <ul class="list-unstyled small mb-0">
                                <li>✔ Vendor chnages done</li>
                                <li>✔ Quantity chnages</li>
                            </ul>
                        </div>
                    </div>

                    <!-- STAGE 1 : MANAGER -->
                    <div class="border rounded p-2 mb-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <p class="mb-0 fw-semibold">Manager Approval</p>
                                <small class="text-muted">3 Members (Quantity and Vendor )</small>
                            </div>

                            <button class="btn btn-sm btn-outline-primary" data-bs-toggle="collapse"
                                data-bs-target="#managerStage">
                                +
                            </button>
                        </div>

                        <div id="managerStage" class="collapse mt-2 border-top pt-2">
                            <small class="text-muted">Activity Details</small>
                            <ul class="list-unstyled small mb-0">
                                <li>✔ Manager 1 approved – 10:15 AM</li>
                                <li>✔ Manager 2 approved – 11:05 AM</li>
                                <li>✔ Manager 3 approved – 12:30 PM</li>
                            </ul>
                        </div>
                    </div>

                    <!-- STAGE 2 : PURCHASE -->
                    <div class="border rounded p-2 mb-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <p class="mb-0 fw-semibold">Purchase Approval</p>
                                <small class="text-muted">Unit Price & Vendor</small>
                            </div>

                            <button class="btn btn-sm btn-outline-primary" data-bs-toggle="collapse"
                                data-bs-target="#purchaseStage">
                                +
                            </button>
                        </div>

                        <div id="purchaseStage" class="collapse mt-2 border-top pt-2">
                            <small class="text-muted">Activity Details</small>
                            <ul class="list-unstyled small mb-0">
                                <li>✔ Vendor Selected – ABC Suppliers</li>
                                <li>✔ Unit Price Added – ₹ 2,000</li>
                                <li>✔ Purchase Reviewed – 03:10 PM</li>
                            </ul>
                        </div>
                    </div>

                    <!-- STAGE 3 : HOD -->
                    <div class="border rounded p-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <p class="mb-0 fw-semibold">HOD Approval</p>
                                <small class="text-muted">Final Approval (Vendor)</small>
                            </div>

                            <button class="btn btn-sm btn-outline-primary" data-bs-toggle="collapse"
                                data-bs-target="#hodStage">
                                +
                            </button>
                        </div>

                        <div id="hodStage" class="collapse mt-2 border-top pt-2">
                            <small class="text-muted">Activity Details</small>
                            <ul class="list-unstyled small mb-0">
                                <li>✔ Final Approval Given</li>
                                <li>✔ Approved Amount – ₹ 2,40,000</li>
                                <li>✔ Approval Time – 05:00 PM</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SUMMARY CARD -->
            <div class="card border-0 shadow-sm mt-3">
                <div class="card-body p-3">

                    <h6 class="fw-bold mb-3">Overall Summary</h6>

                    <div class="row small">
                        <div class="col-6 mb-2">
                            <span class="text-muted">Current Status</span>
                            <div class="fw-semibold text-success">Approved</div>
                        </div>

                        <div class="col-6 mb-2">
                            <span class="text-muted">Total Stages</span>
                            <div class="fw-semibold">3</div>
                        </div>

                        <div class="col-6 mb-2">
                            <span class="text-muted">Completed</span>
                            <div class="fw-semibold text-success">3 / 3</div>
                        </div>

                        <div class="col-6 mb-2">
                            <span class="text-muted">Pending</span>
                            <div class="fw-semibold text-warning">0</div>
                        </div>
                    </div>

                    <!-- STATUS MESSAGE -->
                    <div class="alert alert-success py-2 mt-3 mb-0 small text-center">
                        ✔ All approval stages completed successfully
                    </div>

                </div>
            </div>


        </div>
    </div>
</div>